import{d,u as $,a as G,b as J,j as s,T as p,B as a,Y as i,c as o,e as se,J as te,g as q,N as Q,f as oe,h as ne,i as re,r as ae,L as ie,H as ce,C as z,k as F,l as le,m as de,n as _e}from"./index-BKKkxoBw.js";import{B as Z,T as ue,a as pe,A as be,d as S,s as K,g as fe}from"./AirdropHelper-DqDeMAek.js";const ge="_buy__wrapper_1kl9d_1",ye="_buy__back_1kl9d_10",he="_buy__back_icon_1kl9d_19",me="_buy__container_1kl9d_23",xe="_buy__title_and_logo_1kl9d_30",Ae="_buy__title_1kl9d_30",Ce="_buy__heading_1kl9d_39",ke="_buy__buy_rows_1kl9d_47",we="_buy__balance_1kl9d_52",Se="_buy__balance_value_1kl9d_61",ve="_buy__footer_connect_1kl9d_67",Te="_buy__footer_connect_container_1kl9d_78",Be="_buy__footer_connect_score_1kl9d_85",je="_buy__footer_connect_tokens_1kl9d_91",Oe="_buy__footer_connect_wallet_1kl9d_96",r={buy__wrapper:ge,buy__back:ye,buy__back_icon:he,buy__container:me,buy__title_and_logo:xe,buy__title:Ae,buy__heading:Ce,buy__buy_rows:ke,buy__balance:we,buy__balance_value:Se,buy__footer_connect:ve,buy__footer_connect_container:Te,buy__footer_connect_score:Be,buy__footer_connect_tokens:je,buy__footer_connect_wallet:Oe},Y=[{id:1,countSpins:100,countWhisks:3600},{id:2,countSpins:250,countWhisks:8900},{id:3,countSpins:500,countWhisks:17700},{id:4,countSpins:1e3,countWhisks:35200}],L={hex:"b5ee9c72410107010089000114ff00f4a413f4bcf2c80b01020120040201bcf26c21018209312d00bef2e2c0ed44d0d20001f2d2be88ed54fa40d3ffd3ff3003d33fd43020f9005003baf2e2c1f800820898968070fb02821043c7d5c9c8cb1fcb3fcc12cbffc9718010c8cb055003cf1670fa0212cb6accc98306fb00030001c002014806050011a098d7da89a1ae14010002d0f6f532a9"},Ie="_buy_row__wrapper_en39z_1",Ne="_buy_row__container_en39z_8",We="_buy_row__spins_en39z_13",He="_buy_row__whisks_en39z_18",O={buy_row__wrapper:Ie,buy_row__container:Ne,buy_row__spins:We,buy_row__whisks:He};function Pe(g){return d.beginCell().storeCoins(0).storeAddress(g.admin).storeRef(g.content).storeRef(g.walletCode).endCell()}class I{constructor(t,e){this.address=t,this.init=e}static createFromAddress(t){return new I(t)}static createFromConfig(t,e,u=0){const f=Pe(t),l={code:e,data:f};return new I(d.contractAddress(u,l),l)}async sendDeploy(t,e,u){await t.internal(e,{value:u,sendMode:d.SendMode.PAY_GAS_SEPARATELY,body:d.beginCell().endCell()})}async sendMint(t,e,u,f,l,m){await t.internal(e,{sendMode:d.SendMode.PAY_GAS_SEPARATELY,body:d.beginCell().storeUint(21,32).storeUint(0,64).storeAddress(l).storeCoins(f).storeRef(d.beginCell().storeUint(395134233,32).storeUint(0,64).storeCoins(m).storeAddress(this.address).storeAddress(this.address).storeCoins(0).storeUint(0,1).endCell()).endCell(),value:u+f})}async getWalletAddressOf(t,e){return(await t.get("get_wallet_address",[{type:"slice",cell:d.beginCell().storeAddress(e).endCell()}])).stack.readAddress()}async getWalletCode(t){const e=(await t.get("get_jetton_data",[])).stack;return e.skip(4),e.readCell()}}const Me=g=>{const t=$({query:"(max-width: 600px)"}),{updateBonusSpins:e}=G(),[u]=J(),f=u.connected,{id:l,countSpin:m,countWhisk:x,userId:v,userTonAddress:y}=g,N=async A=>{if(!y)a.error("Please connect TON wallet!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});else if(!f)a.error("Please connect TON Wallet!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});else if(v&&y){const W=o.toNano(x),H=o.Address.parse(se),T=o.Address.parse(y),B=o.beginCell().endCell(),P=o.toNano("0.01"),M=o.beginCell().endCell(),n=te.transferMessage(W,H,T,B,P,M),C=await q({network:Q}),_=new o.TonClient({endpoint:C}),k=new I(o.Address.parse(oe)),j=await _.open(k).getWalletAddressOf(o.Address.parse(y)),w=o.toNano("0.05");try{await u.sendTransaction({messages:[{address:j.toString(),amount:w.toString(),payload:n==null?void 0:n.toBoc().toString("base64")}],validUntil:Date.now()+5*60*1e3});const b=await ne(v,{countSpins:A});(b==null?void 0:b.status)===200?(e(A),a.success(`You bought ${A} spins`,{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i})):a.error("Can't buy spins.",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i})}catch{a.error("User reject transaction",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i})}}};return s.jsx("div",{className:O.buy_row__wrapper,children:s.jsxs("div",{className:O.buy_row__container,children:[s.jsxs("div",{className:O.buy_row__spins,children:[s.jsx(p,{fontSize:t?"26px":"50px",fontFamily:"Roundy Rainbows, sans-serif",children:m}),s.jsx(p,{fontSize:t?"16px":"24px",fontFamily:"Montserrat, sans-serif",children:"spins"})]}),s.jsxs("div",{className:O.buy_row__whisks,children:[s.jsx(p,{fontSize:t?"16px":"28px",fontFamily:"Montserrat, sans-serif",children:BigInt(x).toLocaleString()}),s.jsx(p,{fontSize:t?"16px":"26px",fontFamily:"Montserrat, sans-serif",children:"WHISK"})]}),s.jsx(Z,{onClick:()=>N(m),fontFamily:"Montserrat, sans-serif",height:t?"28px":"52px",fontSize:t?"14px":"28px",boxShadow:"0px 2px 2px rgba(0, 0, 0, 0.1), inset 0px 1px 1px rgb(255 161 161 / 60%), inset 0px -3px 2px rgba(0, 0, 0, 0.2)",text:"Buy now",fontWeight:"normal",width:"fit-content",textTransform:"none",borderRadius:"24px"})]})},l)},Re="/whiskers/assets/back-arrow-BYp4F-0z.png",Ue=()=>{const g=re(),t=$({query:"(max-width: 600px)"}),{userData:e,jettonBalance:u,isClaimable:f,airdropList:l,airdropCell:m,campaignNumber:x,updateClaimedWhisks:v}=G(),[y]=J(),[N,A]=ae.useState(!0),W=y.connected,H=()=>{g(-1)},T=l.findIndex(n=>o.Address.parse(n.userTonAddress).toString()==o.Address.parse((e==null?void 0:e.userTonAddress)||"UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ").toString());let B=0;T!=-1&&(B=l[T].unclaimedWhisks);async function P(n,C){let _=!1,k=25;for(;!_&&k>0;){if(k--,_=await C.isContractDeployed(n),_)return;await K(3e3)}throw new Error("Timeout")}const M=async()=>{if(f!=1)a.error("No snapshot yet. Claim after 7:00 GMT",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});else if(!W)a.error("Connect your TON Wallet and try again",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});else if(e!=null&&e.userId&&(e!=null&&e.userTonAddress)&&x){const n=l.findIndex(c=>c.userId.toString()==(e==null?void 0:e.userId.toString()));if(n!=-1&&l[n].userTonAddress.toString()!=(e==null?void 0:e.userTonAddress.toString())){a.error("Please connect with previous wallet to claim or wait until next snapshot at 7:00 GMT",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});return}const C=await q({network:Q}),_=new o.TonClient({endpoint:C}),R=d.Cell.fromBase64(m||"").beginParse().loadDictDirect(d.Dictionary.Keys.BigUint(256),pe),j=l.findIndex(c=>o.Address.parse(c.userTonAddress).toString()==o.Address.parse(e==null?void 0:e.userTonAddress.toString()).toString());if(j==-1){a.error("Not in the airdrop list. Please wait for the next snapshot!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});return}const w=BigInt(j.toString()),b=R.generateMerkleProof(w);if(!_)a.error("Cannot claim WHISK. Try again",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});else{const c=_.open(be.createFromConfig({campaign_number:BigInt(x),airdrop:o.Address.parse(z),index:w,proofHash:b.hash()},d.Cell.fromBoc(F.from(L.hex,"hex"))[0]));if(await c.getClaimed()){a.error("Already claimed! Please wait for the next snapshot",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});return}if(!await _.isContractDeployed(c.address)){const V=new S.StateInit({code:S.Cell.fromBoc(F.from(L.hex,"hex"))[0],data:S.beginCell().storeBit(!1).storeAddress(S.Address.parse(z)).storeBuffer(b.hash()).storeUint(w,256).storeUint(BigInt(x),16).endCell()}),U=new S.Cell;V.writeTo(U);try{const E=await y.sendTransaction({messages:[{address:c.address.toString(),amount:d.toNano("0.1").toString(),stateInit:U.toBoc().toString("base64")}],validUntil:Date.now()+3e5});await P(c.address,_),await K(1500),await c.sendClaim(123n,b);try{const h=E.boc,X=await fe(o.Address.parse(e==null?void 0:e.userTonAddress),h),D=`${le}${X}`,ee=(await de.get(D)).data.children[0].transaction.success;console.log("txStatus: ",ee)}catch(h){console.log(h)}try{const h=await _e(e.userId);h&&(v(),h.message=="successfully claimed whisks"&&(a.success(`You claimed ${B} $WHISK`,{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i}),A(!1),setTimeout(()=>{A(!0)},3e5)))}catch{a.error("Cannot claim WHISK. Try again",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i})}}catch{a.error("User reject transaction",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i});return}}await _.isContractDeployed(c.address)&&(await c.getClaimed()||await c.sendClaim(123n,b))}}else a.error("Unknown error. Please try again later!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:i})};return s.jsx("div",{className:r.buy__wrapper,children:s.jsxs("div",{className:r.buy__container,children:[s.jsxs("div",{className:r.buy__title_and_logo,children:[s.jsx(ie,{fontSize:"42px"}),s.jsx("span",{className:r.buy__title,children:s.jsx(ce,{className:r.buy__heading,level:"h1",children:"Spin&Earn"})})]}),s.jsx(p,{fontSize:"16px",fontFamily:"Montserrat, sans-serif",children:"Buy bonus spins with WHISK"}),s.jsx("div",{className:r.buy__buy_rows,children:Y&&Y.map(n=>s.jsx(Me,{id:n.id,countSpin:n.countSpins,countWhisk:n.countWhisks,userId:e==null?void 0:e.userId,userTonAddress:e==null?void 0:e.userTonAddress},n.id))}),s.jsxs("div",{className:r.buy__balance,children:[s.jsxs("div",{onClick:H,className:r.buy__back,children:[s.jsx("img",{src:Re,className:r.buy__back_icon,alt:"back to main screen"}),s.jsx(p,{children:"Back"})]}),s.jsxs("div",{className:r.buy__balance_value,children:[s.jsx(p,{fontSize:"14px",fontFamily:"Montserrat, sans-serif",children:"Wallet balance"}),s.jsxs(p,{fontSize:"16px",fontFamily:"Montserrat, sans-serif",children:[u.toLocaleString()," WHISK"]})]})]}),s.jsx("div",{className:r.buy__footer_connect,children:s.jsxs("div",{className:r.buy__footer_connect_container,children:[s.jsxs("div",{className:r.buy__footer_connect_score,children:[s.jsx(p,{fontSize:t?"18px":"40px",children:"Unclaimed WHISK"}),s.jsxs("div",{className:r.buy__footer_connect_tokens,children:[s.jsx(p,{fontSize:t?"30px":"50px",fontFamily:"Roundy Rainbows, sans-serif",children:((e==null?void 0:e.points)||0)-((e==null?void 0:e.claimedWhisks)||0)}),s.jsx(Z,{onClick:M,fontFamily:"Montserrat, sans-serif",height:t?"24px":"42px",fontSize:t?"16px":"40px",backgroundImage:N?"linear-gradient(rgb(32 167 228), rgb(0, 128, 187))":"linear-gradient(#C0C0C0, #808080)",text:"Claim tokens",fontWeight:"normal",width:"fit-content",textTransform:"none",borderRadius:"24px"})]})]}),s.jsx("div",{className:r.buy__footer_connect_wallet,children:s.jsx(ue,{})})]})})]})})},Ye=()=>s.jsx(Ue,{});export{Ye as default};
