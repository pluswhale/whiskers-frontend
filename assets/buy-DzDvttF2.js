import{d as n,u as G,a as $,b as q,j as t,T as f,B as l,Y as _,c as i,g as J,e as se,f as te,L as oe,H as ne,h as Y,i as re,k as ae}from"./index-Dt8oW0_a.js";import{B as Q,T as ie,N as Z,J as de,a as ce,b as le,A as _e,C as z,d as T,s as F,g as ue,c as be}from"./AirdropHelper-BOiLg5Gn.js";function pe(){return n.beginCell().endCell()}class h{constructor(s,e){this.address=s,this.init=e}static createFromAddress(s){return new h(s)}static createFromConfig(s,e=0){const o=pe(),r={code:s,data:o};return new h(n.contractAddress(e,r),r)}async sendDeploy(s,e,o){await s.internal(e,{value:o,sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:n.beginCell().endCell()})}async getJettonBalance(s){return(await s.getState()).state.type!=="active"?0n:(await s.get("get_wallet_data",[])).stack.readBigNumber()}async getJettonWalletData(s){const e=await s.get("get_wallet_data",[]),o=e.stack.readBigNumber(),r=e.stack.readAddress(),a=e.stack.readAddress(),u=e.stack.readCell();return{balance:o,ownerAddress:r,masterAddress:a,walletCode:u}}static transferMessage(s,e,o,r,a,u){return n.beginCell().storeUint(260734629,32).storeUint(0,64).storeCoins(s).storeAddress(e).storeAddress(o).storeMaybeRef(r).storeCoins(a).storeMaybeRef(u).endCell()}async sendTransfer(s,e,o,r,a,u,y,C,g){await s.internal(e,{sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:h.transferMessage(r,a,u,y,C,g),value:o})}static burnMessage(s,e,o){return n.beginCell().storeUint(1499400124,32).storeUint(0,64).storeCoins(s).storeAddress(e).storeMaybeRef(o).endCell()}async sendBurn(s,e,o,r,a,u){await s.internal(e,{sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:h.burnMessage(r,a,u),value:o})}static withdrawTonsMessage(){return n.beginCell().storeUint(1838046780,32).storeUint(0,64).endCell()}async sendWithdrawTons(s,e){await s.internal(e,{sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:h.withdrawTonsMessage(),value:n.toNano("0.1")})}static withdrawJettonsMessage(s,e){return n.beginCell().storeUint(1988776114,32).storeUint(0,64).storeAddress(s).storeCoins(e).storeMaybeRef(null).endCell()}async sendWithdrawJettons(s,e,o,r){await s.internal(e,{sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:h.withdrawJettonsMessage(o,r),value:n.toNano("0.1")})}}const fe="_buy__wrapper_1kl9d_1",ge="_buy__back_1kl9d_10",ye="_buy__back_icon_1kl9d_19",he="_buy__container_1kl9d_23",Ae="_buy__title_and_logo_1kl9d_30",me="_buy__title_1kl9d_30",Ce="_buy__heading_1kl9d_39",we="_buy__buy_rows_1kl9d_47",xe="_buy__balance_1kl9d_52",ke="_buy__balance_value_1kl9d_61",Se="_buy__footer_connect_1kl9d_67",ve="_buy__footer_connect_container_1kl9d_78",Te="_buy__footer_connect_score_1kl9d_85",Be="_buy__footer_connect_tokens_1kl9d_91",Me="_buy__footer_connect_wallet_1kl9d_96",c={buy__wrapper:fe,buy__back:ge,buy__back_icon:ye,buy__container:he,buy__title_and_logo:Ae,buy__title:me,buy__heading:Ce,buy__buy_rows:we,buy__balance:xe,buy__balance_value:ke,buy__footer_connect:Se,buy__footer_connect_container:ve,buy__footer_connect_score:Te,buy__footer_connect_tokens:Be,buy__footer_connect_wallet:Me},L=[{id:1,countSpins:100,countWhisks:3600},{id:2,countSpins:250,countWhisks:8900},{id:3,countSpins:500,countWhisks:17700},{id:4,countSpins:1e3,countWhisks:35200}],K={hex:"b5ee9c72410107010089000114ff00f4a413f4bcf2c80b01020120040201bcf26c21018209312d00bef2e2c0ed44d0d20001f2d2be88ed54fa40d3ffd3ff3003d33fd43020f9005003baf2e2c1f800820898968070fb02821043c7d5c9c8cb1fcb3fcc12cbffc9718010c8cb055003cf1670fa0212cb6accc98306fb00030001c002014806050011a098d7da89a1ae14010002d0f6f532a9"},je="_buy_row__wrapper_en39z_1",Ne="_buy_row__container_en39z_8",Oe="_buy_row__spins_en39z_13",Pe="_buy_row__whisks_en39z_18",O={buy_row__wrapper:je,buy_row__container:Ne,buy_row__spins:Oe,buy_row__whisks:Pe};function Ie(A){return n.beginCell().storeCoins(0).storeAddress(A.admin).storeRef(A.content).storeRef(A.walletCode).endCell()}class P{constructor(s,e){this.address=s,this.init=e}static createFromAddress(s){return new P(s)}static createFromConfig(s,e,o=0){const r=Ie(s),a={code:e,data:r};return new P(n.contractAddress(o,a),a)}async sendDeploy(s,e,o){await s.internal(e,{value:o,sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:n.beginCell().endCell()})}async sendMint(s,e,o,r,a,u){await s.internal(e,{sendMode:n.SendMode.PAY_GAS_SEPARATELY,body:n.beginCell().storeUint(21,32).storeUint(0,64).storeAddress(a).storeCoins(r).storeRef(n.beginCell().storeUint(395134233,32).storeUint(0,64).storeCoins(u).storeAddress(this.address).storeAddress(this.address).storeCoins(0).storeUint(0,1).endCell()).endCell(),value:o+r})}async getWalletAddressOf(s,e){return(await s.get("get_wallet_address",[{type:"slice",cell:n.beginCell().storeAddress(e).endCell()}])).stack.readAddress()}async getWalletCode(s){const e=(await s.get("get_jetton_data",[])).stack;return e.skip(4),e.readCell()}}const Re=A=>{const s=G({query:"(max-width: 600px)"}),{updateBonusSpins:e}=$(),[o]=q(),r=o.connected,{id:a,countSpin:u,countWhisk:y,userId:C,userTonAddress:g}=A,I=async x=>{if(!g)l.error("Please connect TON wallet!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});else if(!r)l.error("Please connect TON Wallet!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});else if(C&&g){const B=i.toNano(y),M=i.Address.parse(ie),R=i.Address.parse(g),H=i.beginCell().endCell(),b=i.toNano("0.01"),k=i.beginCell().endCell(),p=h.transferMessage(B,M,R,H,b,k),S=await J({network:Z}),U=new i.TonClient({endpoint:S}),j=new P(i.Address.parse(de)),w=await U.open(j).getWalletAddressOf(i.Address.parse(g)),d=i.toNano("0.05");try{await o.sendTransaction({messages:[{address:w.toString(),amount:d.toString(),payload:p==null?void 0:p.toBoc().toString("base64")}],validUntil:Date.now()+5*60*1e3});const v=await se(C,{countSpins:x});(v==null?void 0:v.status)===200?(e(x),l.success(`You bought ${x} spins`,{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_})):l.error("Can't buy spins.",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_})}catch{l.error("User reject transaction",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_})}}};return t.jsx("div",{className:O.buy_row__wrapper,children:t.jsxs("div",{className:O.buy_row__container,children:[t.jsxs("div",{className:O.buy_row__spins,children:[t.jsx(f,{fontSize:s?"26px":"50px",fontFamily:"Roundy Rainbows, sans-serif",children:u}),t.jsx(f,{fontSize:s?"16px":"24px",fontFamily:"Montserrat, sans-serif",children:"spins"})]}),t.jsxs("div",{className:O.buy_row__whisks,children:[t.jsx(f,{fontSize:s?"16px":"28px",fontFamily:"Montserrat, sans-serif",children:BigInt(y).toLocaleString()}),t.jsx(f,{fontSize:s?"16px":"26px",fontFamily:"Montserrat, sans-serif",children:"WHISK"})]}),t.jsx(Q,{onClick:()=>I(u),fontFamily:"Montserrat, sans-serif",height:s?"28px":"52px",fontSize:s?"14px":"28px",boxShadow:"0px 2px 2px rgba(0, 0, 0, 0.1), inset 0px 1px 1px rgb(255 161 161 / 60%), inset 0px -3px 2px rgba(0, 0, 0, 0.2)",text:"Buy now",fontWeight:"normal",width:"fit-content",textTransform:"none",borderRadius:"24px"})]})},a)},He="/whiskers/assets/back-arrow-BYp4F-0z.png",Ue=()=>{const A=te(),s=G({query:"(max-width: 600px)"}),{userData:e,jettonBalance:o,isClaimable:r,airdropList:a,airdropCell:u,campaignNumber:y,updateClaimedWhisks:C}=$(),[g]=q(),I=g.connected,x=()=>{A(-1)},B=a.findIndex(b=>i.Address.parse(b.userTonAddress).toString()==i.Address.parse((e==null?void 0:e.userTonAddress)||"UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJKZ").toString());let M=0;B!=-1&&(M=a[B].unclaimedWhisks);async function R(b,k){let p=!1,S=25;for(;!p&&S>0;){if(S--,p=await k.isContractDeployed(b),p)return;await F(3e3)}throw new Error("Timeout")}const H=async()=>{if(r!=1)l.error("No snapshot yet. Claim after 7:00 GMT",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});else if(!I)l.error("Connect your TON Wallet and try again",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});else if(e!=null&&e.userId&&(e!=null&&e.userTonAddress)&&y){const b=a.findIndex(d=>d.userId.toString()==(e==null?void 0:e.userId.toString()));if(b!=-1&&a[b].userTonAddress.toString()!=(e==null?void 0:e.userTonAddress.toString())){l.error("Please connect with previous wallet to claim or wait until next snapshot at 7:00 GMT",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});return}const k=await J({network:Z}),p=new i.TonClient({endpoint:k}),U=n.Cell.fromBase64(u||"").beginParse().loadDictDirect(n.Dictionary.Keys.BigUint(256),le),j=a.findIndex(d=>i.Address.parse(d.userTonAddress).toString()==i.Address.parse(e==null?void 0:e.userTonAddress.toString()).toString());if(j==-1){l.error("Not in the airdrop list. Please wait for the next snapshot!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});return}const N=BigInt(j.toString()),w=U.generateMerkleProof(N);if(!p)l.error("Cannot claim WHISK. Try again",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});else{const d=p.open(_e.createFromConfig({campaign_number:BigInt(y),airdrop:i.Address.parse(z),index:N,proofHash:w.hash()},n.Cell.fromBoc(Y.from(K.hex,"hex"))[0]));if(await d.getClaimed()){l.error("Already claimed! Please wait for the next snapshot",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});return}if(!await p.isContractDeployed(d.address)){const V=new T.StateInit({code:T.Cell.fromBoc(Y.from(K.hex,"hex"))[0],data:T.beginCell().storeBit(!1).storeAddress(T.Address.parse(z)).storeBuffer(w.hash()).storeUint(N,256).storeUint(BigInt(y),16).endCell()}),W=new T.Cell;V.writeTo(W);try{const E=await g.sendTransaction({messages:[{address:d.address.toString(),amount:n.toNano("0.1").toString(),stateInit:W.toBoc().toString("base64")}],validUntil:Date.now()+3e5});await R(d.address,p),await F(1500),await d.sendClaim(123n,w);const X=E.boc,D=await ue(i.Address.parse(e==null?void 0:e.userTonAddress),X);try{const m=`${be}${D}`,ee=(await re.get(m)).data.children[0].transaction.success;console.log("txStatus: ",ee)}catch(m){console.log(m)}try{const m=await ae(e.userId);m&&(C(),m.message=="successfully claimed whisks"&&l.success(`You claimed ${M} $WHISK`,{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_}))}catch{l.error("Cannot claim WHISK. Try again",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_})}}catch{l.error("User reject transaction",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_});return}}await p.isContractDeployed(d.address)&&(await d.getClaimed()||await d.sendClaim(123n,w))}}else l.error("Unknown error. Please try again later!",{position:"bottom-left",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:_})};return t.jsx("div",{className:c.buy__wrapper,children:t.jsxs("div",{className:c.buy__container,children:[t.jsxs("div",{className:c.buy__title_and_logo,children:[t.jsx(oe,{fontSize:"42px"}),t.jsx("span",{className:c.buy__title,children:t.jsx(ne,{className:c.buy__heading,level:"h1",children:"Spin&Earn"})})]}),t.jsx(f,{fontSize:"16px",fontFamily:"Montserrat, sans-serif",children:"Buy bonus spins with WHISK"}),t.jsx("div",{className:c.buy__buy_rows,children:L&&L.map(b=>t.jsx(Re,{id:b.id,countSpin:b.countSpins,countWhisk:b.countWhisks,userId:e==null?void 0:e.userId,userTonAddress:e==null?void 0:e.userTonAddress},b.id))}),t.jsxs("div",{className:c.buy__balance,children:[t.jsxs("div",{onClick:x,className:c.buy__back,children:[t.jsx("img",{src:He,className:c.buy__back_icon,alt:"back to main screen"}),t.jsx(f,{children:"Back"})]}),t.jsxs("div",{className:c.buy__balance_value,children:[t.jsx(f,{fontSize:"14px",fontFamily:"Montserrat, sans-serif",children:"Wallet balance"}),t.jsxs(f,{fontSize:"16px",fontFamily:"Montserrat, sans-serif",children:[o.toLocaleString()," WHISK"]})]})]}),t.jsx("div",{className:c.buy__footer_connect,children:t.jsxs("div",{className:c.buy__footer_connect_container,children:[t.jsxs("div",{className:c.buy__footer_connect_score,children:[t.jsx(f,{fontSize:s?"18px":"40px",children:"Unclaimed WHISK"}),t.jsxs("div",{className:c.buy__footer_connect_tokens,children:[t.jsx(f,{fontSize:s?"30px":"50px",fontFamily:"Roundy Rainbows, sans-serif",children:((e==null?void 0:e.points)||0)-((e==null?void 0:e.claimedWhisks)||0)}),t.jsx(Q,{onClick:H,fontFamily:"Montserrat, sans-serif",height:s?"24px":"42px",fontSize:s?"16px":"40px",backgroundColor:"#0080bb",text:"Claim tokens",fontWeight:"normal",width:"fit-content",textTransform:"none",borderRadius:"24px"})]})]}),t.jsx("div",{className:c.buy__footer_connect_wallet,children:t.jsx(ce,{})})]})})]})})},ze=()=>t.jsx(Ue,{});export{ze as default};
